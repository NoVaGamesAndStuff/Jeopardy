<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Room</title>
    <style>
        table { border-collapse: collapse; } 
        td, th { border: 1px solid black; padding: 8px; }
    </style>
</head>
<body>
    <h1>Jeopardy</h1>

    <div id="roomInfoContainer" style="display: none;">
        <p id="roomCode" style="font-weight: bold;"></p>
        <p id="hostName" style="font-weight: bold;"></p>
        <button id="startGameButton" style="display: none;" onclick="startGame()">Start Game</button>
    </div>

    <br>

    <div>
        Players:
    </div>

    <table id="playerTable">
        <tr>
            <th>Display Name</th>
            <th>Score</th>
        </tr>
    </table>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        const socket = io();
        const roomKey = window.location.pathname.split('/').pop();
        const socketId = socket.id;

        socket.emit('getRoom', roomKey);

        socket.on('getRoomInfo', ({ room, isHost }) => {
            console.log('Got room info:', room);
            updatePlayerTable(room.players);

            // Display room code and host name if the host connected
            if (room.host) {
                const roomCodeContainer = document.getElementById('roomInfoContainer');
                const roomCodeElement = document.getElementById('roomCode');
                const hostNameElement = document.getElementById('hostName');
                roomCodeElement.textContent = `Room Code: ${room.key}`;
                hostNameElement.textContent = `The host is ${room.host.name}`;
                roomCodeContainer.style.display = 'block';
            }

            if (isHost) {
                const startGameButton = document.getElementById('startGameButton');
                startGameButton.style.display = 'block';
            }
        });

        function updatePlayerTable(players) {
            console.log('Received updated player data:', players);
            const playerTable = document.getElementById('playerTable');

            // Clear existing rows from the table
            while (playerTable.rows.length > 1) {
                playerTable.deleteRow(1);
            }

            // Add new rows to the table
            players.forEach(player => {
                console.log(player);
                const row = playerTable.insertRow();
                const nameCell = row.insertCell(0);
                const scoreCell = row.insertCell(1);
                nameCell.textContent = player.name;
                scoreCell.textContent = player.score;
            });
        }

        function startGame() {
            console.log('Game will now start.');
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Room</title>
    <style>
        table { border-collapse: collapse; } 
        td, th { border: 1px solid black; padding: 8px; }
    </style>
</head>
<body>
    <h1>Jeopardy</h1>

    <div id="roomInfoContainer" style="display: none;">
        <p id="roomCode" style="font-weight: bold;"></p>
        <p id="hostName" style="font-weight: bold;"></p>
        <button id="startGameButton" style="display: none;" onclick="startGame()">Start Game</button>
    </div>

    <br>

    <div>
        Players:
    </div>

    <table id="playerTable">
        <tr>
            <th>Display Name</th>
            <th>Score</th>
        </tr>
    </table>

    <div id="boardContainer" style="display: block;">
        
    <!-- </div> -->
    <!-- <div id="wagerContainer" style="display: block;"> -->
        <!-- <button id="setWagerButton"onclick="setWager()">Set Wager</button> -->
        <!-- <input id="wager_input" name="wager_input" type="text" /> -->
        
    <!-- </div> -->


    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
    const socket = io();
    const roomKey = window.location.pathname.split('/').pop();
    const socketId = socket.id;
    let boardContainer = document.getElementById("boardContainer");
    let doubleJeopardy = false;
    let finalJeopardy = false;
    let singleJeopardyCells = 30;
    let doubleJeopardyCells = 60; 
    let wagerValue = 0;

    const sampleBoard = 
    {
        Single: 
        [
            
            {
                category: "Anagrams",
                clues:
                [
                    {
                    clue: "An American symbol: BAGEL DEAL",
                    answer: "BALD EAGLE",
                    value: 200,
                    dailydouble: false
                    },
                    {
                    clue: "An ancient reptile: AIR SOUND",
                    answer: "DINOSAUR",
                    value: 400,
                    dailydouble: false
                    },
                    {
                    clue: "Heavenly predator of the coral reef: FLAG SHINE",
                    answer: "ANGELFISH",
                    value: 600,
                    dailydouble: false
                    },
                    {
                    clue: "Classmate from overseas: SNUG TEACH EXTEND",
                    answer: "EXCHANGE STUDENT",
                    value: 800,
                    dailydouble: false
                    },
                    {
                    clue: "Adjective meaning morally wrong: LEACH UNIT",
                    answer: "UNETHICAL",
                    value: 1000,
                    dailydouble: false
                    }
                ]
            },
            {
                category: "Code Words"
                clues: 
                [
                    {
                    clue: "A very popular coding language that you might find in the zoo",
                    answer: "Python",
                    value: 200,
                    dailydouble: false
                    },
                    {
                    clue: "You may find one covered in leaves in the forest, or in your repository",
                    answer: "A Branch",
                    value: 400,
                    dailydouble: false
                    },
                    {
                    clue: "A past tense chomp, or a unit of information",
                    answer: "A bit",
                    value: 600,
                    dailydouble: false
                    },
                    {
                    clue: "Not to be confused with the underwater Manta, this data structure",
                    answer: "An Array",
                    value: 800,
                    dailydouble: false
                    },
                    {
                    clue: "Primogeniture is one method used to determine what objects belong to who, or you can simply derive.",
                    answer: "Inheritance",
                    value: 1000,
                    dailydouble: false
                    }
                ]
            },
            {
                category: "'Web' Dev"
                clues: 
                [
                    {
                    clue: "Where a URL may take you",
                    answer: "Website",
                    value: 200,
                    dailydouble: false
                    },
                    {
                    clue: "The self-made home of an eight-legged creature",
                    answer: "Spiderweb",
                    value: 400,
                    dailydouble: false
                    },
                    {
                    clue: "Having these types of feet aid in aquatic locomotion ",
                    answer: "Webbed",
                    value: 600,
                    dailydouble: false
                    },
                    {
                    clue: "You might use one in conjunction with a microphone for your livestream",
                    answer: "Webcam",
                    value: 800,
                    dailydouble: false
                    },
                    {
                    clue: "A Noah who can help you know new words",
                    answer: "Webster",
                    value: 1000,
                    dailydouble: false
                    }
                ]
            },
            {
                category: "Magic Shows"
                clues: 
                [
                    {
                    clue: "Toss a coin to Henry Cavill, who plays Geralt in this Netflix favorite",
                    answer: "The Witcher",
                    value: 200,
                    dailydouble: false
                    },
                    {
                    clue: "The superhero name of this marvelous magic user Maximoff who landed her own show on Disney+",
                    answer: "Scarlet Witch",
                    value: 400,
                    dailydouble: false
                    },
                    {
                    clue: "A family of magic-wielders can be found in a sandwich shop set on this real New York City street in Manhattan that stretches from Bank Street to Broadway",
                    answer: "Wizards of Waverly Place",
                    value: 600,
                    dailydouble: false
                    },
                    {
                    clue: "The law of equivalent exchange doesn't stop some serious displays of alchemy in this 2009 Anime",
                    answer: "Fullmetal Alchemist: Brotherhood",
                    value: 800,
                    dailydouble: true
                    },
                    {
                    clue: "Vampires and demons stood no chance in this popular magic show which even had its own musical episode: Once More, with Feeling",
                    answer: "Buffy the Vampire Slayer",
                    value: 1000,
                    dailydouble: false
                    }
                ]
            },
            {
                category: "Finals Week"
                clues: 
                [
                    {
                    clue: "Gruesome deaths await pretty much everyone in this series of horror movies",
                    answer: "Final Destination",
                    value: 200,
                    dailydouble: false
                    },
                    {
                    clue: "Cloud Strife is just one of many main characters you may play in one of gamings longest running franchises ",
                    answer: "Final Fantasy",
                    value: 400,
                    dailydouble: false
                    },
                    {
                    clue: "Space, as famously dubbed by Star Trek",
                    answer: "The Final Frontier",
                    value: 600,
                    dailydouble: false
                    },
                    {
                    clue: "Break a ball or charge a meter to activate this ultimate attack found in Nintendo's most popular fighting game",
                    answer: "Final Smash",
                    value: 800,
                    dailydouble: false
                    },
                    {
                    clue: "Swedish rock band Europe is responsible for this chart topping glam metal song",
                    answer: "The Final Countdown",
                    value: 1000,
                    dailydouble: false
                    }
                ]
            },
            {
                category: "Before and After"
                clues: 
                [
                    {
                    clue: "Duane who performs on stage in front of thousands",
                    answer: "The Rock Star",
                    value: 200,
                    dailydouble: false
                    },
                    {
                    clue: "The animals boarded two by two to escape flooding before Indy and the Nazis fought over control in Raiders",
                    answer: "Noah's Ark of the Covenant",
                    value: 400,
                    dailydouble: false
                    },
                    {
                    clue: "Deliver your package with free 2 hour shipping- or three, five, seven, or eleven if you prefer",
                    answer: "Amazon Prime Number",
                    value: 600,
                    dailydouble: false
                    },
                    {
                    clue: "Watch where you're going while playing this Niantic mobile game, but make sure you catch 'em ALL",
                    answer: "Pokemon Go Getter",
                    value: 800,
                    dailydouble: false
                    },
                    {
                    clue: "A stereotypical Australian phrase and a newly reimagined movie couple",
                    answer: "Throw another shrimp on the Barbie and Ken",
                    value: 1000,
                    dailydouble: false
                    }
                ]
            }
        ],
        Double: 
        [
            
            {
                category: "Anagrams",
                clues:
                [
                    {
                    clue: "An American symbol: BAGEL DEAL",
                    answer: "BALD EAGLE",
                    value: 400,
                    dailydouble: false
                    },
                    {
                    clue: "An ancient reptile: AIR SOUND",
                    answer: "DINOSAUR",
                    value: 800,
                    dailydouble: false
                    },
                    {
                    clue: "Heavenly predator of the coral reef: FLAG SHINE",
                    answer: "ANGELFISH",
                    value: 1200,
                    dailydouble: false
                    },
                    {
                    clue: "Classmate from overseas: SNUG TEACH EXTEND",
                    answer: "EXCHANGE STUDENT",
                    value: 1600,
                    dailydouble: false
                    },
                    {
                    clue: "Adjective meaning morally wrong: LEACH UNIT",
                    answer: "UNETHICAL",
                    value: 2000,
                    dailydouble: false
                    }
                ]
            },
            {
                category: "Code Words"
                clues: 
                [
                    {
                    clue: "A very popular coding language that you might find in the zoo",
                    answer: "Python",
                    value: 400,
                    dailydouble: false
                    },
                    {
                    clue: "You may find one covered in leaves in the forest, or in your repository",
                    answer: "A Branch",
                    value: 800,
                    dailydouble: false
                    },
                    {
                    clue: "A past tense chomp, or a unit of information",
                    answer: "A Bit",
                    value: 1200,
                    dailydouble: false
                    },
                    {
                    clue: "Not to be confused with the underwater Manta, this data structure",
                    answer: "An Array",
                    value: 1600,
                    dailydouble: false
                    },
                    {
                    clue: "Primogeniture is one method used to determine what objects belong to who, or you can simply derive.",
                    answer: "Inheritance",
                    value: 2000,
                    dailydouble: false
                    }
                ]
            },
            {
                category: "'Web' Dev"
                clues: 
                [
                    {
                    clue: "Where a URL may take you",
                    answer: "Website",
                    value: 400,
                    dailydouble: false
                    },
                    {
                    clue: "The self-made home of an eight-legged creature",
                    answer: "Spiderweb",
                    value: 800,
                    dailydouble: false
                    },
                    {
                    clue: "Having these types of feet aid in aquatic locomotion ",
                    answer: "Webbed",
                    value: 1200,
                    dailydouble: false
                    },
                    {
                    clue: "You might use one in conjunction with a microphone for your livestream",
                    answer: "Webcam",
                    value: 1600,
                    dailydouble: false
                    },
                    {
                    clue: "A Noah who can help you know new words",
                    answer: "Webster",
                    value: 2000,
                    dailydouble: true
                    }
                ]
            },
            {
                category: "Magic Shows"
                clues: 
                [
                    {
                    clue: "Toss a coin to Henry Cavill, who plays Geralt in this Netflix favorite",
                    answer: "The Witcher",
                    value: 400,
                    dailydouble: false
                    },
                    {
                    clue: "The superhero name of this marvelous magic user Maximoff who landed her own show on Disney+",
                    answer: "Scarlet Witch",
                    value: 800,
                    dailydouble: false
                    },
                    {
                    clue: "A family of magic-wielders can be found in a sandwich shop set on this real New York City street in Manhattan that stretches from Bank Street to Broadway",
                    answer: "Wizards of Waverly Place",
                    value: 1200,
                    dailydouble: false
                    },
                    {
                    clue: "The law of equivalent exchange doesn't stop some serious displays of alchemy in this 2009 Anime",
                    answer: "Fullmetal Alchemist: Brotherhood",
                    value: 1600,
                    dailydouble: false
                    },
                    {
                    clue: "Vampires and demons stood no chance in this popular magic show which even had its own musical episode: Once More, with Feeling",
                    answer: "Buffy the Vampire Slayer",
                    value: 2000,
                    dailydouble: false
                    }
                ]
            },
            {
                category: "Finals Week"
                clues: 
                [
                    {
                    clue: "Gruesome deaths await pretty much everyone in this series of horror movies",
                    answer: "Final Destination",
                    value: 400,
                    dailydouble: false
                    },
                    {
                    clue: "Cloud Strife is just one of many main characters you may play in one of gamings longest running franchises ",
                    answer: "Final Fantasy",
                    value: 800,
                    dailydouble: false
                    },
                    {
                    clue: "Space, as famously dubbed by Star Trek",
                    answer: "The Final Frontier",
                    value: 1200,
                    dailydouble: true
                    },
                    {
                    clue: "Break a ball or charge a meter to activate this ultimate attack found in Nintendo's most popular fighting game",
                    answer: "Final Smash",
                    value: 1600,
                    dailydouble: false
                    },
                    {
                    clue: "Swedish rock band Europe is responsible for this chart topping glam metal song",
                    answer: "The Final Countdown",
                    value: 2000,
                    dailydouble: false
                    }
                ]
            },
            {
                category: "Before and After"
                clues: 
                [
                    {
                    clue: "Duane who performs on stage in front of thousands",
                    answer: "The Rock Star",
                    value: 400,
                    dailydouble: false
                    },
                    {
                    clue: "The animals boarded two by two to escape flooding before Indy and the Nazis fought over control in Raiders",
                    answer: "Noah's Ark of the Covenant",
                    value: 800,
                    dailydouble: false
                    },
                    {
                    clue: "Deliver your package with free 2 hour shipping- or three, five, seven, or eleven if you prefer",
                    answer: "Amazon Prime Number",
                    value: 1200,
                    dailydouble: false
                    },
                    {
                    clue: "Watch where you're going while playing this Niantic mobile game, but make sure you catch 'em ALL",
                    answer: "Pokemon Go Getter",
                    value: 1600,
                    dailydouble: false
                    },
                    {
                    clue: "A stereotypical Australian phrase and a newly reimagined movie couple",
                    answer: "Throw another shrimp on the Barbie and Ken",
                    value: 2000,
                    dailydouble: false
                    }
                ]
            }
        ],
        Final:
        {
            category: "Drexel University"
            clue:
            [
                {
                    clue "Final Question"                    
                    answer: "Final Answer"
                }
            ]
        }
        
    };


    socket.emit('getRoom', roomKey);

    socket.on('getRoomInfo', ({ room, isHost }) => {
        console.log('Got room info:', room);
        updatePlayerTable(room.players);

        if (room.host) {
            const roomCodeContainer = document.getElementById('roomInfoContainer');
            const roomCodeElement = document.getElementById('roomCode');
            const hostNameElement = document.getElementById('hostName');
            roomCodeElement.textContent = `Room Code: ${room.key}`;
            hostNameElement.textContent = `The host is ${room.host.name}`;
            roomCodeContainer.style.display = 'block';
        }

        if (isHost) {
            const startGameButton = document.getElementById('startGameButton');
            startGameButton.style.display = 'block';
        }
    });

    function updatePlayerTable(players) {
        console.log('Received updated player data:', players);
        const playerTable = document.getElementById('playerTable');

        while (playerTable.rows.length > 1) {
            playerTable.deleteRow(1);
        }

        players.forEach(player => {
            console.log(player);
            const row = playerTable.insertRow();
            const nameCell = row.insertCell(0);
            const scoreCell = row.insertCell(1);
            nameCell.textContent = player.name;
            scoreCell.textContent = player.score;
        });
    }

    let selectedCells = new Set();

    function displayZoomedCell(baseValue, questionText) {
        let zoomedCell = document.createElement('div');
        zoomedCell.style.backgroundColor = 'blue';
        zoomedCell.style.textShadow = '2px 2px 2px black';
        zoomedCell.style.color = 'white';
        zoomedCell.style.verticalAlign = 'middle';
        zoomedCell.style.textAlign = 'center';
        zoomedCell.style.fontSize = '36px';
        zoomedCell.style.padding = '40px';
        zoomedCell.style.position = 'absolute';
        zoomedCell.style.top = '50%';
        zoomedCell.style.left = '50%';
        zoomedCell.style.transform = 'translate(-50%, -50%)';
        zoomedCell.style.cursor = 'pointer';
        zoomedCell.textContent = `$${baseValue}\n${questionText}`;

        boardContainer.innerHTML = ''; 
        boardContainer.appendChild(zoomedCell);



        zoomedCell.addEventListener('click', function () {
            boardContainer.innerHTML = '';
            if (!finalJeopardy){
                displayBoard(createBoard(6, 6), doubleJeopardy, finalJeopardy);
            }
            else{

                displayBoard(createBoard(2,1), doubleJeopardy, finalJeopardy);
            }      
            

            
            selectedCells.forEach((questionText, cell) => {
                cell.style.color = 'red';
                cell.style.cursor = 'default'; 
                cell.style.backgroundColor = 'gray';
                cell.removeEventListener('click', handleCellClick); 
            });
        });
    }

    function handleCellClick(event) {
        console.log("Cell clicked!");
        
        const clickedCell = event.target;

        if (!selectedCells.has(clickedCell.id)) { 
            console.log("Unclicked cell clicked!");
            const baseValue = parseInt(clickedCell.textContent.replace('$', ''));
            const questionID = clickedCell.id;
            const questionText = `${questionID}`; 
            selectedCells.add(questionID); 

            clickedCell.style.backgroundColor = 'gray'; 
            clickedCell.removeEventListener('click', handleCellClick); 
            singleJeopardyCells--;
            doubleJeopardyCells--;

            if (singleJeopardyCells === 0) {
                doubleJeopardy = true;
            }
            if (doubleJeopardyCells === 0){
                doubleJeopardy = false;
                finalJeopardy = true;
            }


            displayZoomedCell(baseValue, questionText);
        }
    }



    function displayBoard(board, doubleJeopardy, finalJeopardy) {
        while (boardContainer.firstChild) {
            boardContainer.removeChild(boardContainer.firstChild);
        }

        let jeopardyBoard = document.createElement('table');
        jeopardyBoard.style.width = '1000px';
        jeopardyBoard.style.height = '600px';
        //jeopardyBoard.style.float = 'center';
        jeopardyBoard.style.position = 'absolute';
        jeopardyBoard.style.top = '50%';
        jeopardyBoard.style.left = '50%';
        jeopardyBoard.style.transform = 'translate(-50%, -50%)';

        for (let i = 0; i < board.length; i++) {
            let row = document.createElement('tr');

            for (let j = 0; j < board[i].length; j++) {
                let cell = document.createElement('td');
                cell.style.backgroundColor = 'blue';
                cell.style.textShadow = '2px 2px 2px black';
                cell.style.color = 'white';
                cell.style.verticalAlign = 'top';
                cell.style.textAlign = 'center';
                let idStr = ""+i+j;
                cell.id = parseInt(idStr);

                if (i === 0) {
                    cell.style.height = '40px';
                    cell.textContent = 'Category';
                } else {
                    cell.style.height = '100px';
                    if (i >= 1 && i <= 5) {
                        let baseValue = i * 200;

                        if (doubleJeopardy) {
                            baseValue *= 2;
                            cell.id = idStr + "d";
                        }

                        cell.textContent = `$${baseValue}`;
                        cell.addEventListener('click', handleCellClick);
                    } else {
                        cell.textContent = 'Question';
                    }
                }

                row.appendChild(cell);
            }
            jeopardyBoard.appendChild(row);
        }
        boardContainer.appendChild(jeopardyBoard);
    }

    function createBoard(rows, columns) {
        let board = [];

        for (let i = 0; i < rows; i++) {
            let row = [];

            for (let j = 0; j < columns; j++) {
                row.push((i + j) % 2 === 0);
            }
            board.push(row);
        }
        return board;
    }

    function startGame() {
        console.log("board being created");
        
        let jeopardyBoard = createBoard(6, 6);
        displayBoard(jeopardyBoard, doubleJeopardy, finalJeopardy);
    }

    
    function setWager(wager, gameState){
        

        if(singleJeopardy){
            if(currentPlayer.score < wager){
                console.log("Your score must be greater than or equal to your wager.")
            }
            else if(currentPlayer.score < wager || wager <= 1000){
                wagerValue = wager;
            }
            else if(currentPlayer.score > wager)
            {
                wagerValue = wager;
            }
        }
        if(doubleJeopardy){
            if(currentPlayer.score < wager){
                    console.log("Your score must be greater than or equal to your wager.")
                }
                else if(currentPlayer.score < wager || wager <= 2000){
                    wagerValue = wager;
                }
                else if(currentPlayer.score > wager)
                {
                    wagerValue = wager;
                }
            }
        if(finalJeopardy){
            if(currentPlayer.score < wager){
                console.log("Your score must be greater than or equal to your wager.")
            }
            else
            {
                wagerValue = wager;
            }
        }

        console.log("Wager set");

    }
    




</script>


</body>
</html>
